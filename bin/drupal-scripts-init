#!/bin/bash
# 24.03.2015
# v0.1
# $SCRPIT_HELP - help text

SCRIPT_SIMULATE=""

[ -r /etc/drupal-scripts.conf ] && . /etc/drupal-scripts.conf
[ -r ~/.drupal-scripts.conf ] && . ~/.drupal-scripts.conf

function usage {
    version="$(grep '# \?v[0-9.]\+' -o $0 | tr -d '# ')"
    script_name="$(basename $0)"
    echo "$script_name $version"
    echo "$SCRIPT_HELP" | sed "s/{0}/${script_name}/g"
}

function is_drupal {
    [ -r includes/bootstrap.inc ] && echo 1 || echo ""
}

function get_domain {
    echo ${PWD##*/}
}

function check_drush {
    command -v drush >/dev/null 2>&1 || {
        echo >&2 "Drush required but it's not installed. Aborting."
        exit 1
    }
}

function check_drupal {
    if [ -z "$(is_drupal)" ]; then
        echo "Current directory \"$PWD\" is not in Drupal root path, aborting."
        exit 1
    fi
}

while getopts ":s" opt; do
    case "$opt" in
        s) SCRIPT_SIMULATE="1"
        ;;
    esac
done

if [ "$1" = "--help" ] && [ -n "$SCRIPT_HELP" ]; then
    usage
    exit 1
fi
