#!/bin/bash
# v0.2
# 24.03.2014
# 24.12.2014 - добавлен параметр домена сайта (--uri). По умолчанию доменом считается название папки сайта, нужно для simplenews
# 23.03.2015 - изменены параметры команды, cron вынесен в параметры

SCRIPT_HELP="
Run Drush cron in correct environment.

Usage: {0} root_path
        - run drush cron in root_path
       {0} root_path elysia-cron
        - run drush elysia-cron in root_path
       {0} root_path cron domain
        - run drush cron in root_path using domain.
          Need for override http://default.
          Default domain - basename of root_path"

. drupal-scripts-init

check_drush

if [ $# -lt 1 ]; then
	usage
	exit 1
fi

root_path="$1"

drush_command="cron" # elysia-cron
if [ $# -ge 2 ]; then
	drush_command="$2"
fi

if [ $# -ge 3 ]; then
	domain="$3"
else
	domain=$(basename "$root_path")
fi
uri="http://$domain"


cd "$root_path"
user=$(whoami)
env PATH=/usr/local/bin:/usr/bin:/bin USER="$user" COLUMNS=72 drush --root="$root_path" --uri="$uri" --quiet "$drush_command"
